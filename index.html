<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>調查結果互動式報表</title>
  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- DataLabels Plugin CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .chart-container { width: 45%; display: inline-block; vertical-align: top; margin: 2%; }
    .full-width { width: 94%; margin: 2% auto; }
    h2 { font-size: 1.2em; margin-top: 40px; }
    .type-label { font-size: 0.9em; color: #555; margin-bottom: 4px; }
  </style>
</head>
<body>

  <h1>調查結果互動式報表</h1>

  <!-- 基本統計：部門人數分布 -->
  <div class="chart-container">
    <p class="type-label"><strong>分析類型：基本統計</strong></p>
    <h2>各部門人數分布</h2>
    <canvas id="deptChart"></canvas>
  </div>

  <!-- 多選題頻次：使用困難 -->
  <div class="full-width">
    <p class="type-label"><strong>分析類型：多選題頻次分析</strong></p>
    <h2>使用 ChatGPT 的最大困難頻次</h2>
    <canvas id="issuesChart"></canvas>
  </div>

<script>
  // 註冊 DataLabels 外掛
  Chart.register(ChartDataLabels);

  // 主要高亮色
  const highlight = '#9E2A2B';
  // 其他輔助色
  const others = ['#26547C','#FF6F59','#FFBA08','#70C1B3','#50514F'];

  // 部門資料 (已將「研發」「浩氣研發」合併為「浩氣」)
  const deptLabels = ["機械","工程","財務","資材","電控","業務","研發部","浩氣"];
  const deptData   = [11,7,4,3,3,3,2,2];

  // 使用困難多選題
  const issLabels  = [
    "得到的答案不夠準確或太籠統",
    "不知道它能做什麼",
    "不知道怎麼問問題",
    "看不懂介面／不知道從哪開始",
    "沒有。",
    "如何在生活或工作中做更多的結合",
    "沒時間學習",
    "目前就是還不夠了解ChatGPT 功能能使用到哪",
    "未付費",
    "功能上有限制",
    "沒使用過",
    "怎知道有什麼困難"
  ];
  const issData    = [15,11,10,6,1,1,1,1,1,1,1,1];

  // 幫助函式：對陣列標記前3高亮，其餘依次用others循環
  function getTop3Colors(data) {
    const sortedTop3 = [...data].sort((a,b)=>b-a).slice(0,3);
    let idx = 0;
    return data.map(v => {
      if (sortedTop3.includes(v)) return highlight;
      return others[(idx++ ) % others.length];
    });
  }

  // 繪製長條圖 (部門人數)
  new Chart(document.getElementById('deptChart'), {
    type: 'bar',
    data: {
      labels: deptLabels,
      datasets: [{
        label: '人數',
        data: deptData,
        backgroundColor: getTop3Colors(deptData)
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: false },
        datalabels: {
          anchor: 'end',
          align: 'top',
          formatter: v => v,
          color: '#000',
          font: { weight: 'bold' }
        }
      },
      scales: {
        y: { beginAtZero: true }
      }
    }
  });

  // 繪製長條圖 (使用困難)
  new Chart(document.getElementById('issuesChart'), {
    type: 'bar',
    data: {
      labels: issLabels,
      datasets: [{
        label: '人數',
        data: issData,
        backgroundColor: getTop3Colors(issData)
      }]
    },
    options: {
      indexAxis: 'y',
      responsive: true,
      plugins: {
        legend: { display: false },
        datalabels: {
          anchor: 'end',
          align: 'right',
          formatter: v => v,
          color: '#000',
          font: { weight: 'bold' }
        }
      },
      scales: {
        x: { beginAtZero: true }
      }
    }
  });

</script>

</body>
</html>
